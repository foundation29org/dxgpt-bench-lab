<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis Unificado - Modelos Clínicos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #ffffff;
            color: #333333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 95%;
            max-width: 1400px;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333333;
            text-align: center;
            margin-bottom: 10px;
            font-weight: 300;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #666666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .dual-chart-container {
            display: flex;
            align-items: stretch;
            gap: 0;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background: linear-gradient(to right, 
                rgba(22, 163, 74, 0.03) 0%, 
                rgba(22, 163, 74, 0.03) 48%, 
                rgba(220, 38, 38, 0.03) 52%, 
                rgba(220, 38, 38, 0.03) 100%);
        }
        .chart-panel {
            position: relative;
            flex: 1;
            height: 600px;
            border-right: 1px dashed #ccc;
        }
        .chart-panel:last-child {
            border-right: none;
        }
        .chart-panel canvas {
            width: 100% !important;
            height: 100% !important;
        }
        .panel-label {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            color: #666;
            border: 1px solid #ddd;
            z-index: 10;
        }
        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 25px;
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        .legend-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .legend-group-title {
            font-weight: 600;
            font-size: 14px;
            color: #333;
            margin-bottom: 5px;
        }
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-symbol {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        .info-box {
            background-color: #f5f5f5;
            border-left: 4px solid #4CAF50;
            padding: 20px;
            margin-top: 20px;
            border-radius: 4px;
        }
        .info-box h3 {
            margin-top: 0;
            color: #333333;
        }
        .axis-info {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Análisis Unificado de Modelos Clínicos</h1>
        <p class="subtitle">Visualización Comparativa con Escalas Optimizadas por Grupo</p>
        
        <div class="axis-info">
            <strong>Eje Y (Vertical):</strong> Semántica → <strong>Eje X (Horizontal):</strong> Severidad (izq: peor → der: mejor)
        </div>
        
        <div class="dual-chart-container">
            <div class="chart-panel">
                <div class="panel-label">Modelos Especializados</div>
                <canvas id="chartVerdes"></canvas>
            </div>
            <div class="chart-panel">
                <div class="panel-label">Modelos OpenAI</div>
                <canvas id="chartRojos"></canvas>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-group">
                <div class="legend-group-title">Modelos Especializados</div>
                <div class="legend-items" id="legendVerdes">
                    <!-- Legend items will be injected by JavaScript -->
                </div>
            </div>
            <div class="legend-group">
                <div class="legend-group-title">Modelos OpenAI</div>
                <div class="legend-items" id="legendRojos">
                    <!-- Legend items will be injected by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="info-box">
            <h3>Interpretación Mejorada</h3>
            <p><strong>Visualización Dividida:</strong> Cada panel muestra un grupo de modelos con su propia escala optimizada en el eje X (Severidad)</p>
            <p><strong>Eje Y Compartido:</strong> Ambos paneles usan la misma escala vertical, permitiendo comparación directa del rendimiento</p>
            <p><strong>Panel Izquierdo (Verde):</strong> Modelos especializados médicos - Escala de severidad: 0.50 a 0.25</p>
            <p><strong>Panel Derecho (Rojo):</strong> Modelos OpenAI generales - Escala de severidad: 0.20 a 0.15</p>
            <p><strong>Ventaja:</strong> Se eliminó el espacio vacío entre grupos, maximizando el detalle visible de cada cluster</p>
        </div>
    </div>

    <script>
        // Datos base
        const performanceData = {
            '4o': { base: 78.78, llm: 81.70 },
            '4-1': { base: 74.22, llm: 77.50 },
            'o1': { base: 76.33, llm: 84.10 },
            'o3': { base: 80.46, llm: 84.30 },
            'o3-pro': { base: 79.89, llm: 83.90 }
        };

        const semanticData = {
            'Sakura': { semantic: 0.6521, severity: 0.2813 },
            'OpenBio': { semantic: 0.6439, severity: 0.3979 },
            'JonSnow': { semantic: 0.5971, severity: 0.5052 },
            'MedGemma': { semantic: 0.5782, severity: 0.4318 }
        };

        const styles = {
            '4o': { style: 'circle', color: 'rgba(220, 38, 38, 0.7)', border: '#dc2626' },
            '4-1': { style: 'rectRot', color: 'rgba(220, 38, 38, 0.7)', border: '#dc2626' },
            'o1': { style: 'rect', color: 'rgba(220, 38, 38, 0.7)', border: '#dc2626' },
            'o3': { style: 'star', color: 'rgba(220, 38, 38, 0.7)', border: '#dc2626' },
            'o3-pro': { style: 'cross', color: 'rgba(220, 38, 38, 0.7)', border: '#dc2626' },
            'Sakura': { style: 'circle', color: 'rgba(22, 163, 74, 0.7)', border: '#16a34a' },
            'OpenBio': { style: 'rectRot', color: 'rgba(22, 163, 74, 0.7)', border: '#16a34a' },
            'JonSnow': { style: 'rect', color: 'rgba(22, 163, 74, 0.7)', border: '#16a34a' },
            'MedGemma': { style: 'star', color: 'rgba(22, 163, 74, 0.7)', border: '#16a34a' }
        };

        const svgShapes = {
            circle: (color, borderColor) => `<svg width="16" height="16"><circle cx="8" cy="8" r="7" fill="${color}" stroke-width="2" stroke="${borderColor}"/></svg>`,
            triangle: (color, borderColor) => `<svg width="16" height="16"><polygon points="8,2 14,14 2,14" fill="${color}" stroke-width="2" stroke="${borderColor}"/></svg>`,
            rect: (color, borderColor) => `<svg width="16" height="16"><rect x="2" y="2" width="12" height="12" fill="${color}" stroke-width="2" stroke="${borderColor}"/></svg>`,
            star: (color, borderColor) => `<svg width="16" height="16"><path d="M8,1 L9.5,6 L14,6 L10.5,9 L12,14 L8,11 L4,14 L5.5,9 L2,6 L6.5,6 Z" fill="${color}" stroke-width="1" stroke="${borderColor}"/></svg>`,
            cross: (color, borderColor) => `<svg width="16" height="16"><line x1="2" y1="8" x2="14" y2="8" stroke="${borderColor}" stroke-width="2"/><line x1="8" y1="2" x2="8" y2="14" stroke="${borderColor}" stroke-width="2"/></svg>`
        };
        
        function createLegend(containerId, models) {
            const container = document.getElementById(containerId);
            Object.keys(models).forEach(model => {
                const item = document.createElement('div');
                item.className = 'legend-item';
                
                const styleInfo = styles[model];
                let shapeName = styleInfo.style;
                if (shapeName === 'rectRot') {
                    shapeName = 'triangle';
                }
                
                const fillColor = shapeName === 'cross' ? 'transparent' : styleInfo.color;

                item.innerHTML = `
                    <div class="legend-symbol">${svgShapes[shapeName](fillColor, styleInfo.border)}</div>
                    <span>${model}</span>
                `;
                container.appendChild(item);
            });
        }

        // Configuración del gráfico de modelos verdes (especializados)
        const ctx1 = document.getElementById('chartVerdes').getContext('2d');
        const datasetsVerdes = Object.entries(semanticData).map(([model, data]) => ({
            label: model,
            data: [{
                x: data.severity,
                y: data.semantic,
            }],
            backgroundColor: styles[model].color,
            borderColor: styles[model].border,
            borderWidth: 2,
            pointStyle: styles[model].style,
            pointRadius: 12,
            pointHoverRadius: 15
        }));

        const chartVerdes = new Chart(ctx1, {
            type: 'scatter',
            data: { datasets: datasetsVerdes },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const data = semanticData[context.dataset.label];
                                return [
                                    `${context.dataset.label}`,
                                    `Semántica: ${context.parsed.y.toFixed(3)}`,
                                    `Severidad: ${context.parsed.x.toFixed(3)}`
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'linear',
                        min: 0.25,
                        max: 0.52,
                        reverse: true,
                        title: {
                            display: true,
                            text: '← Severidad',
                            color: '#333333',
                            font: { size: 12, weight: 'bold' }
                        },
                        grid: { color: 'rgba(0, 0, 0, 0.1)', borderDash: [3, 3] },
                        ticks: { color: '#666666', font: { size: 11 } }
                    },
                    y: {
                        min: 0.55,
                        max: 0.67,
                        title: {
                            display: true,
                            text: 'Semántica',
                            color: '#333333',
                            font: { size: 12, weight: 'bold' }
                        },
                        grid: { color: 'rgba(0, 0, 0, 0.1)', borderDash: [3, 3] },
                        ticks: { 
                            color: '#666666',
                            font: { size: 11 },
                            callback: function(value) {
                                return (value * 100).toFixed(0) + '%';
                            }
                        }
                    }
                }
            }
        });

        // Configuración del gráfico de modelos rojos (OpenAI)
        const ctx2 = document.getElementById('chartRojos').getContext('2d');
        const datasetsRojos = Object.entries(performanceData).map(([model, data]) => ({
            label: model,
            data: [{
                x: 1 - (data.llm / 100),
                y: data.llm / 100,
            }],
            backgroundColor: styles[model].color,
            borderColor: styles[model].border,
            borderWidth: 2,
            pointStyle: styles[model].style,
            pointRadius: 12,
            pointHoverRadius: 15
        }));

        const chartRojos = new Chart(ctx2, {
            type: 'scatter',
            data: { datasets: datasetsRojos },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const data = performanceData[context.dataset.label];
                                return [
                                    `${context.dataset.label}`,
                                    `Semántica LLM: ${data.llm}%`,
                                    `Semántica Base: ${data.base}%`,
                                    `Mejora: +${(data.llm - data.base).toFixed(2)}%`
                                ];
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        type: 'linear',
                        min: 0.15,
                        max: 0.23,
                        reverse: true,
                        title: {
                            display: true,
                            text: '← Severidad',
                            color: '#333333',
                            font: { size: 12, weight: 'bold' }
                        },
                        grid: { color: 'rgba(0, 0, 0, 0.1)', borderDash: [3, 3] },
                        ticks: { color: '#666666', font: { size: 11 } }
                    },
                    y: {
                        min: 0.77,
                        max: 0.85,
                        title: {
                            display: true,
                            text: 'Semántica',
                            color: '#333333',
                            font: { size: 12, weight: 'bold' }
                        },
                        grid: { color: 'rgba(0, 0, 0, 0.1)', borderDash: [3, 3] },
                        ticks: { 
                            color: '#666666',
                            font: { size: 11 },
                            callback: function(value) {
                                return (value * 100).toFixed(0) + '%';
                            }
                        }
                    }
                }
            }
        });

        createLegend('legendVerdes', semanticData);
        createLegend('legendRojos', performanceData);

        console.log('Gráfico unificado cargado correctamente');
    </script>
</body>
</html>