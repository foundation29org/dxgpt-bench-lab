<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Model Performance Analysis</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #ffffff;
            color: #333333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #333333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        h2 {
            color: #333333;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #8B5CF6;
            padding-bottom: 10px;
        }
        
        .chart-container {
            background-color: #ffffff;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .chart-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #333333;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background-color: #ffffff;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #8B5CF6;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #666666;
            font-weight: 500;
        }
        
        .model-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #333333;
            margin-bottom: 10px;
        }
        
        .stacked-bar {
            display: flex;
            height: 40px;
            margin-bottom: 15px;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #E5E7EB;
        }
        
        .stack-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9em;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #E5E7EB;
        }
        
        .legend-label {
            font-size: 1em;
            color: #333333;
            font-weight: 500;
        }
        
        /* COLOR MATRIX STYLES */
        .color-matrix {
            display: grid;
            grid-template-columns: 150px repeat(4, 1fr);
            gap: 3px;
            margin: 20px 0;
            font-size: 0.9em;
        }
        
        .matrix-header {
            background-color: #F8FAFC;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            color: #333333;
            border: 1px solid #E5E7EB;
        }
        
        .matrix-cell {
            padding: 15px;
            text-align: center;
            border: 1px solid #E5E7EB;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 60px;
            border-radius: 4px;
        }
        
        .matrix-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .matrix-subtitle {
            font-size: 0.8em;
            color: #ffffff;
            margin-top: 2px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        /* HISTOGRAM STYLES */
        .histogram-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 20px 0;
        }
        
        .histogram-chart {
            background-color: #F8FAFC;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 20px;
        }
        
        .histogram-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333333;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .histogram-bars {
            display: flex;
            align-items: end;
            justify-content: space-around;
            height: 150px;
            margin-bottom: 10px;
        }
        
        .histogram-bar {
            width: 50px;
            background: linear-gradient(to top, #8B5CF6, #A78BFA);
            border-radius: 4px 4px 0 0;
            display: flex;
            align-items: end;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
            padding-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            border: 1px solid #7C3AED;
        }
        
        .histogram-labels {
            display: flex;
            justify-content: space-around;
            margin-top: 5px;
        }
        
        .histogram-label {
            font-size: 0.9em;
            font-weight: 600;
            color: #333333;
        }
        
        /* LINE CHART STYLES */
        .line-chart-container {
            background-color: #F8FAFC;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .line-chart {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        .line-chart-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(to right, #E5E7EB 1px, transparent 1px),
                linear-gradient(to bottom, #E5E7EB 1px, transparent 1px);
            background-size: 20% 20%;
        }
        
        .line-chart-line {
            position: absolute;
            stroke-width: 4;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        .line-chart-point {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 3px solid #ffffff;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            font-weight: bold;
            color: white;
        }
        
        .line-chart-labels {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }
        
        .line-chart-label {
            font-size: 0.9em;
            font-weight: 600;
            color: #333333;
        }
        
        /* HEAT MAP STYLES */
        .heatmap-container {
            margin: 20px 0;
        }
        
        .heatmap-grid {
            display: grid;
            grid-template-columns: 200px repeat(4, 1fr);
            gap: 2px;
            margin: 20px 0;
        }
        
        .heatmap-cell {
            padding: 20px;
            text-align: center;
            border-radius: 6px;
            border: 1px solid #E5E7EB;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 80px;
        }
        
        .heatmap-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .heatmap-subtitle {
            font-size: 0.85em;
            color: #ffffff;
            margin-top: 4px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        /* Purple color palette */
        .purple-1 { background-color: #8B5CF6; }
        .purple-2 { background-color: #A78BFA; }
        .purple-3 { background-color: #C4B5FD; }
        .purple-4 { background-color: #DDD6FE; }
        .purple-5 { background-color: #EDE9FE; }
        
        /* Model-specific colors */
        .model-4o { background-color: #8B5CF6; }
        .model-o1 { background-color: #A78BFA; }
        .model-o3 { background-color: #C4B5FD; }
        .model-o3pro { background-color: #DDD6FE; }
        
        /* Top position colors */
        .top-p1 { background-color: #8B5CF6; }
        .top-p2 { background-color: #A78BFA; }
        .top-p3 { background-color: #C4B5FD; }
        .top-p4 { background-color: #DDD6FE; }
        .top-p5 { background-color: #EDE9FE; }
        
        /* Intensity colors for heatmaps */
        .intensity-very-high { background-color: #581C87; }
        .intensity-high { background-color: #7C3AED; }
        .intensity-medium { background-color: #8B5CF6; }
        .intensity-low { background-color: #A78BFA; }
        .intensity-very-low { background-color: #C4B5FD; }
        
        /* Line colors */
        .line-4o { stroke: #8B5CF6; }
        .line-o1 { stroke: #A78BFA; }
        .line-o3 { stroke: #C4B5FD; }
        .line-o3pro { stroke: #DDD6FE; }
        
        .point-4o { background-color: #8B5CF6; }
        .point-o1 { background-color: #A78BFA; }
        .point-o3 { background-color: #C4B5FD; }
        .point-o3pro { background-color: #DDD6FE; }
        
        /* BUBBLE CHART STYLES */
        .bubble-chart {
            position: relative;
            height: 400px;
            margin: 20px 0;
            background-color: #F8FAFC;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .bubble-chart-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(to right, #E5E7EB 1px, transparent 1px),
                linear-gradient(to bottom, #E5E7EB 1px, transparent 1px);
            background-size: 10% 10%;
        }
        
        .bubble {
            position: absolute;
            border-radius: 50%;
            border: 3px solid #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .bubble:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        
        .bubble-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            font-weight: 600;
            color: #333333;
            white-space: nowrap;
            background-color: rgba(255,255,255,0.9);
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid #E5E7EB;
        }
        
        .bubble-axes {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            top: 0;
            pointer-events: none;
        }
        
        .bubble-axis-x {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255,255,255,0.9);
            border-top: 2px solid #8B5CF6;
            font-weight: 600;
            color: #333333;
        }
        
        .bubble-axis-y {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 30px;
            width: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255,255,255,0.9);
            border-right: 2px solid #8B5CF6;
            font-weight: 600;
            color: #333333;
            writing-mode: vertical-lr;
            text-orientation: mixed;
        }
        
        /* HYBRID MATRIX STYLES */
        .hybrid-matrix {
            display: grid;
            grid-template-columns: 180px repeat(4, 1fr);
            gap: 8px;
            margin: 20px 0;
        }
        
        .hybrid-cell {
            padding: 20px;
            text-align: center;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100px;
            position: relative;
        }
        
        .hybrid-circle {
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            border: 3px solid #ffffff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin-bottom: 8px;
        }
        
        .hybrid-info {
            font-size: 0.75em;
            color: #333333;
            text-align: center;
            line-height: 1.2;
        }
        
        .hybrid-usage {
            font-weight: bold;
            color: #8B5CF6;
        }
        
        .hybrid-performance {
            color: #666666;
        }
        
        /* SCATTER PLOT STYLES */
        .scatter-plot {
            position: relative;
            height: 350px;
            margin: 20px 0;
            background-color: #F8FAFC;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 40px;
        }
        
        .scatter-point {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .scatter-point:hover {
            transform: scale(1.3);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .scatter-tooltip {
            position: absolute;
            background-color: rgba(0,0,0,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 500;
            pointer-events: none;
            z-index: 1000;
            white-space: nowrap;
            transform: translate(-50%, -100%);
            margin-top: -8px;
        }
        
        .scatter-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(0,0,0,0.9);
        }
        
        .chart-legend {
            margin-top: 20px;
            padding: 15px;
            background-color: #F8FAFC;
            border: 1px solid #E5E7EB;
            border-radius: 6px;
        }
        
        .legend-title {
            font-weight: 600;
            color: #333333;
            margin-bottom: 10px;
        }
        
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .legend-item-detailed {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: #333333;
        }
        
        /* PROPORTIONAL FILL MATRIX STYLES */
        .proportional-matrix {
            display: grid;
            grid-template-columns: 180px repeat(4, 1fr);
            gap: 4px;
            margin: 20px 0;
        }
        
        .proportional-cell {
            background-color: #F8FAFC;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 4px;
            display: flex;
            align-items: center;
            min-height: 60px;
            position: relative;
            overflow: hidden;
        }
        
        .proportional-bar {
            height: 100%;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            transition: all 0.3s ease;
            position: relative;
            min-width: 40px;
        }
        
        .proportional-bar:hover {
            filter: brightness(1.1);
        }
        
        .proportional-value {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            color: #333333;
            font-weight: 600;
            background-color: rgba(255,255,255,0.9);
            padding: 2px 6px;
            border-radius: 4px;
            z-index: 10;
        }
        
        /* HORIZONTAL STACKED HISTOGRAMS */
        .horizontal-histograms {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        
        .horizontal-histogram {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .histogram-method-label {
            width: 150px;
            text-align: right;
            font-weight: 600;
            color: #333333;
            font-size: 0.9em;
        }
        
        .horizontal-stacked-bar {
            flex: 1;
            height: 35px;
            background-color: #F3F4F6;
            border-radius: 6px;
            overflow: hidden;
            display: flex;
            border: 1px solid #E5E7EB;
            position: relative;
        }
        
        .horizontal-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            border-right: 1px solid rgba(255,255,255,0.3);
            transition: all 0.2s ease;
            position: relative;
        }
        
        .horizontal-segment:hover {
            filter: brightness(1.1);
            transform: scaleY(1.1);
        }
        
        .horizontal-segment:last-child {
            border-right: none;
        }
        
        .segment-tooltip {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 100;
        }
        
        .horizontal-segment:hover .segment-tooltip {
            opacity: 1;
        }
        
        .histogram-total {
            width: 80px;
            text-align: left;
            font-weight: 600;
            color: #8B5CF6;
            font-size: 0.9em;
        }
        
        /* Model-specific colors for horizontal segments */
        .segment-4o { background-color: #8B5CF6; }
        .segment-o1 { background-color: #A78BFA; }
        .segment-o3 { background-color: #C4B5FD; }
        .segment-o3pro { background-color: #DDD6FE; }
        
        /* Method-specific colors for horizontal segments */
        .method-snomed-match { background-color: #8B5CF6; }
        .method-icd10-exact { background-color: #A78BFA; }
        .method-icd10-sibling { background-color: #C4B5FD; }
        .method-icd10-parent { background-color: #DDD6FE; }
        .method-bert-autoconfirm { background-color: #EDE9FE; color: #333333; }
        .method-bert-match { background-color: #7C3AED; }
        .method-llm-judgment { background-color: #581C87; }
        
        /* GLOBAL PERFORMANCE HISTOGRAMS */
        .global-histograms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 20px 0;
        }
        
        .global-histogram {
            background-color: #F8FAFC;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .global-histogram-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333333;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .global-histogram-bars {
            display: flex;
            align-items: end;
            justify-content: space-around;
            width: 100%;
            height: 180px;
            margin-bottom: 15px;
            gap: 10px;
        }
        
        .global-histogram-bar {
            width: 50px;
            background: linear-gradient(to top, #8B5CF6, #A78BFA);
            border-radius: 6px 6px 0 0;
            display: flex;
            align-items: end;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
            padding-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            border: 2px solid #7C3AED;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .global-histogram-bar:hover {
            filter: brightness(1.1);
            transform: scale(1.05);
        }
        
        .global-histogram-bar::after {
            content: attr(data-label);
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            color: #333333;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .global-histogram-labels {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 10px;
            gap: 10px;
        }
        
        .global-histogram-label {
            font-size: 0.85em;
            font-weight: 600;
            color: #333333;
            text-align: center;
            width: 50px;
        }
        
        .global-histogram-subtitle {
            font-size: 0.9em;
            color: #666666;
            text-align: center;
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Medical Model Performance Analysis</h1>
        
        <h2>1. Global Model Performance Overview</h2>
        <div class="chart-container">
            <div class="chart-title">Overall Performance Metrics</div>
            <div class="metrics-grid" id="globalMetrics"></div>
        </div>
        
        <h2>1b. Global Performance Histograms</h2>
        <div class="chart-container">
            <div class="chart-title">Comparative Performance Percentages</div>
            <div id="globalHistograms"></div>
        </div>
        
        <h2>2. Top Position Distribution Analysis</h2>
        <div class="chart-container">
            <div class="chart-title">Horizontal Stacked Top Positions (P1-P5)</div>
            <div id="topPositionChart"></div>
        </div>
        
        <h2>3. Bi-Statistical Analysis: Usage vs Performance</h2>
        <div class="chart-container">
            <div class="chart-title">Bubble Chart: Usage Frequency (Size) × Performance Quality (Color)</div>
            <div id="bubbleChart"></div>
        </div>
        
        <h2>4. Hybrid Matrix: Dual-Encoded Method Analysis</h2>
        <div class="chart-container">
            <div class="chart-title">Circle Size = Usage Frequency, Color Intensity = Performance Quality</div>
            <div id="hybridMatrix"></div>
        </div>
        
        <h2>5. Model Usage Distribution</h2>
        <div class="chart-container">
            <div class="chart-title">Horizontal Stacked Bars: Case Count by Model Across Methods</div>
            <div id="methodHistograms"></div>
        </div>
        
        <h2>6. Performance Trends Line Chart</h2>
        <div class="chart-container">
            <div class="chart-title">Average Position Trends Across Methods</div>
            <div id="lineChart"></div>
        </div>
        
        <h2>7. Model Comparison Matrix</h2>
        <div class="chart-container">
            <div class="chart-title">Case Count and Average Position by Method</div>
            <div id="comparisonMatrix"></div>
        </div>
    </div>

    <script>
        const data = {
            "4o": {"global": {"total_cases": 450, "matched_cases": 434, "unmatched_cases": 16, "top_counts": {"P5": 20, "P1": 299, "P4": 23, "P2": 66, "P3": 26}, "resolution_method_counts": {"SNOMED_MATCH": 208, "ICD10_EXACT": 26, "ICD10_CHILD": 0, "ICD10_PARENT": 6, "ICD10_SIBLING": 30, "BERT_AUTOCONFIRM": 16, "BERT_MATCH": 17, "LLM_JUDGMENT": 131}, "average_position": 1.615, "final_score_percentage": 87.7}, "by_method": {"BERT_AUTOCONFIRM": {"total_cases": 16, "matched_cases": 16, "unmatched_cases": 0, "top_counts": {"P5": 1, "P4": 3, "P1": 8, "P2": 4}, "average_position": 2.062, "final_score_percentage": 100.0}, "BERT_MATCH": {"total_cases": 17, "matched_cases": 17, "unmatched_cases": 0, "top_counts": {"P1": 15, "P3": 1, "P4": 1}, "average_position": 1.294, "final_score_percentage": 100.0}, "ICD10_EXACT": {"total_cases": 26, "matched_cases": 26, "unmatched_cases": 0, "top_counts": {"P5": 2, "P2": 2, "P1": 20, "P3": 2}, "average_position": 1.538, "final_score_percentage": 100.0}, "ICD10_PARENT": {"total_cases": 6, "matched_cases": 6, "unmatched_cases": 0, "top_counts": {"P1": 5, "P5": 1}, "average_position": 1.667, "final_score_percentage": 100.0}, "ICD10_SIBLING": {"total_cases": 30, "matched_cases": 30, "unmatched_cases": 0, "top_counts": {"P1": 15, "P2": 8, "P5": 2, "P4": 3, "P3": 2}, "average_position": 1.967, "final_score_percentage": 100.0}, "LLM_JUDGMENT": {"total_cases": 131, "matched_cases": 131, "unmatched_cases": 0, "top_counts": {"P4": 14, "P5": 10, "P2": 29, "P3": 15, "P1": 63}, "average_position": 2.076, "final_score_percentage": 100.0}, "SNOMED_MATCH": {"total_cases": 208, "matched_cases": 208, "unmatched_cases": 0, "top_counts": {"P1": 173, "P3": 6, "P2": 23, "P4": 2, "P5": 4}, "average_position": 1.274, "final_score_percentage": 100.0}}},
            "o1": {"global": {"total_cases": 450, "matched_cases": 437, "unmatched_cases": 13, "top_counts": {"P5": 17, "P2": 59, "P3": 37, "P1": 305, "P4": 19}, "resolution_method_counts": {"SNOMED_MATCH": 211, "ICD10_EXACT": 29, "ICD10_CHILD": 0, "ICD10_PARENT": 1, "ICD10_SIBLING": 31, "BERT_AUTOCONFIRM": 15, "BERT_MATCH": 18, "LLM_JUDGMENT": 132}, "average_position": 1.59, "final_score_percentage": 88.19}, "by_method": {"BERT_AUTOCONFIRM": {"total_cases": 15, "matched_cases": 15, "unmatched_cases": 0, "top_counts": {"P5": 2, "P1": 11, "P4": 1, "P3": 1}, "average_position": 1.867, "final_score_percentage": 100.0}, "BERT_MATCH": {"total_cases": 18, "matched_cases": 18, "unmatched_cases": 0, "top_counts": {"P3": 3, "P1": 12, "P2": 2, "P4": 1}, "average_position": 1.611, "final_score_percentage": 100.0}, "ICD10_EXACT": {"total_cases": 29, "matched_cases": 29, "unmatched_cases": 0, "top_counts": {"P4": 3, "P2": 5, "P1": 18, "P3": 3}, "average_position": 1.69, "final_score_percentage": 100.0}, "ICD10_PARENT": {"total_cases": 1, "matched_cases": 1, "unmatched_cases": 0, "top_counts": {"P2": 1}, "average_position": 2.0, "final_score_percentage": 100.0}, "ICD10_SIBLING": {"total_cases": 31, "matched_cases": 31, "unmatched_cases": 0, "top_counts": {"P2": 10, "P4": 2, "P5": 3, "P1": 14, "P3": 2}, "average_position": 2.032, "final_score_percentage": 100.0}, "LLM_JUDGMENT": {"total_cases": 132, "matched_cases": 132, "unmatched_cases": 0, "top_counts": {"P3": 22, "P1": 71, "P2": 23, "P5": 10, "P4": 6}, "average_position": 1.947, "final_score_percentage": 100.0}, "SNOMED_MATCH": {"total_cases": 211, "matched_cases": 211, "unmatched_cases": 0, "top_counts": {"P2": 18, "P1": 179, "P3": 6, "P4": 6, "P5": 2}, "average_position": 1.265, "final_score_percentage": 100.0}}},
            "o3": {"global": {"total_cases": 450, "matched_cases": 433, "unmatched_cases": 17, "top_counts": {"P1": 311, "P2": 59, "P5": 9, "P3": 40, "P4": 14}, "resolution_method_counts": {"SNOMED_MATCH": 216, "ICD10_EXACT": 23, "ICD10_CHILD": 0, "ICD10_PARENT": 6, "ICD10_SIBLING": 23, "BERT_AUTOCONFIRM": 18, "BERT_MATCH": 24, "LLM_JUDGMENT": 123}, "average_position": 1.501, "final_score_percentage": 89.98}, "by_method": {"BERT_AUTOCONFIRM": {"total_cases": 18, "matched_cases": 18, "unmatched_cases": 0, "top_counts": {"P1": 11, "P2": 3, "P5": 1, "P3": 3}, "average_position": 1.722, "final_score_percentage": 100.0}, "BERT_MATCH": {"total_cases": 24, "matched_cases": 24, "unmatched_cases": 0, "top_counts": {"P1": 16, "P4": 3, "P2": 3, "P3": 2}, "average_position": 1.667, "final_score_percentage": 100.0}, "ICD10_EXACT": {"total_cases": 23, "matched_cases": 23, "unmatched_cases": 0, "top_counts": {"P5": 1, "P2": 5, "P1": 15, "P3": 2}, "average_position": 1.565, "final_score_percentage": 100.0}, "ICD10_PARENT": {"total_cases": 6, "matched_cases": 6, "unmatched_cases": 0, "top_counts": {"P1": 4, "P3": 2}, "average_position": 1.667, "final_score_percentage": 100.0}, "ICD10_SIBLING": {"total_cases": 23, "matched_cases": 23, "unmatched_cases": 0, "top_counts": {"P1": 10, "P3": 4, "P2": 5, "P5": 2, "P4": 2}, "average_position": 2.174, "final_score_percentage": 100.0}, "LLM_JUDGMENT": {"total_cases": 123, "matched_cases": 123, "unmatched_cases": 0, "top_counts": {"P1": 73, "P2": 24, "P4": 5, "P3": 20, "P5": 1}, "average_position": 1.675, "final_score_percentage": 100.0}, "SNOMED_MATCH": {"total_cases": 216, "matched_cases": 216, "unmatched_cases": 0, "top_counts": {"P2": 19, "P1": 182, "P5": 4, "P4": 4, "P3": 7}, "average_position": 1.282, "final_score_percentage": 100.0}}},
            "o3pro": {"global": {"total_cases": 450, "matched_cases": 437, "unmatched_cases": 13, "top_counts": {"P5": 24, "P1": 299, "P2": 71, "P3": 28, "P4": 15}, "resolution_method_counts": {"SNOMED_MATCH": 216, "ICD10_EXACT": 19, "ICD10_CHILD": 0, "ICD10_PARENT": 3, "ICD10_SIBLING": 22, "BERT_AUTOCONFIRM": 20, "BERT_MATCH": 23, "LLM_JUDGMENT": 134}, "average_position": 1.613, "final_score_percentage": 87.73}, "by_method": {"BERT_AUTOCONFIRM": {"total_cases": 20, "matched_cases": 20, "unmatched_cases": 0, "top_counts": {"P5": 2, "P1": 14, "P2": 3, "P4": 1}, "average_position": 1.7, "final_score_percentage": 100.0}, "BERT_MATCH": {"total_cases": 23, "matched_cases": 23, "unmatched_cases": 0, "top_counts": {"P2": 6, "P1": 17}, "average_position": 1.261, "final_score_percentage": 100.0}, "ICD10_EXACT": {"total_cases": 19, "matched_cases": 19, "unmatched_cases": 0, "top_counts": {"P5": 3, "P1": 14, "P2": 2}, "average_position": 1.737, "final_score_percentage": 100.0}, "ICD10_PARENT": {"total_cases": 3, "matched_cases": 3, "unmatched_cases": 0, "top_counts": {"P1": 2, "P4": 1}, "average_position": 2.0, "final_score_percentage": 100.0}, "ICD10_SIBLING": {"total_cases": 22, "matched_cases": 22, "unmatched_cases": 0, "top_counts": {"P1": 12, "P3": 3, "P2": 4, "P5": 3}, "average_position": 2.0, "final_score_percentage": 100.0}, "LLM_JUDGMENT": {"total_cases": 134, "matched_cases": 134, "unmatched_cases": 0, "top_counts": {"P1": 66, "P5": 9, "P2": 32, "P4": 11, "P3": 16}, "average_position": 1.993, "final_score_percentage": 100.0}, "SNOMED_MATCH": {"total_cases": 216, "matched_cases": 216, "unmatched_cases": 0, "top_counts": {"P2": 24, "P1": 174, "P5": 7, "P3": 9, "P4": 2}, "average_position": 1.352, "final_score_percentage": 100.0}}}
        };

        function getIntensityClass(value, min, max) {
            const normalized = (value - min) / (max - min);
            if (normalized >= 0.8) return 'intensity-very-high';
            if (normalized >= 0.6) return 'intensity-high';
            if (normalized >= 0.4) return 'intensity-medium';
            if (normalized >= 0.2) return 'intensity-low';
            return 'intensity-very-low';
        }

        function createGlobalMetrics() {
            const container = document.getElementById('globalMetrics');
            const models = ['4o', 'o1', 'o3', 'o3pro'];
            
            models.forEach(model => {
                const modelData = data[model].global;
                const card = document.createElement('div');
                card.className = 'metric-card';
                card.innerHTML = `
                    <div class="model-name">${model.toUpperCase()}</div>
                    <div class="metric-value">${modelData.final_score_percentage}%</div>
                    <div class="metric-label">Final Score</div>
                    <div style="margin-top: 10px;">
                        <div style="font-size: 1.2em; color: #8B5CF6; font-weight: bold;">${modelData.average_position.toFixed(3)}</div>
                        <div class="metric-label">Avg Position</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <div style="font-size: 1.2em; color: #8B5CF6; font-weight: bold;">${modelData.matched_cases}/${modelData.total_cases}</div>
                        <div class="metric-label">Matched Cases</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function createGlobalHistograms() {
            const container = document.getElementById('globalHistograms');
            const models = ['4o', 'o1', 'o3', 'o3pro'];
            
            const histogramContainer = document.createElement('div');
            histogramContainer.className = 'global-histograms';
            
            // Create Final Score Percentage Histogram
            const finalScoreChart = document.createElement('div');
            finalScoreChart.className = 'global-histogram';
            
            const finalScoreTitle = document.createElement('div');
            finalScoreTitle.className = 'global-histogram-title';
            finalScoreTitle.textContent = 'Final Score Percentage';
            
            const finalScoreBars = document.createElement('div');
            finalScoreBars.className = 'global-histogram-bars';
            
            const maxFinalScore = Math.max(...models.map(model => data[model].global.final_score_percentage));
            
            models.forEach(model => {
                const modelData = data[model].global;
                const percentage = modelData.final_score_percentage;
                const height = (percentage / maxFinalScore) * 100;
                
                const bar = document.createElement('div');
                bar.className = 'global-histogram-bar';
                bar.style.height = `${height}%`;
                bar.textContent = `${percentage}%`;
                bar.setAttribute('data-label', model.toUpperCase());
                bar.title = `${model.toUpperCase()}: ${percentage}%`;
                
                finalScoreBars.appendChild(bar);
            });
            
            const finalScoreLabels = document.createElement('div');
            finalScoreLabels.className = 'global-histogram-labels';
            models.forEach(model => {
                const label = document.createElement('div');
                label.className = 'global-histogram-label';
                label.textContent = model.toUpperCase();
                finalScoreLabels.appendChild(label);
            });
            
            const finalScoreSubtitle = document.createElement('div');
            finalScoreSubtitle.className = 'global-histogram-subtitle';
            finalScoreSubtitle.textContent = 'Higher is better';
            
            finalScoreChart.appendChild(finalScoreTitle);
            finalScoreChart.appendChild(finalScoreBars);
            finalScoreChart.appendChild(finalScoreLabels);
            finalScoreChart.appendChild(finalScoreSubtitle);
            
            // Create Match Rate Histogram
            const matchRateChart = document.createElement('div');
            matchRateChart.className = 'global-histogram';
            
            const matchRateTitle = document.createElement('div');
            matchRateTitle.className = 'global-histogram-title';
            matchRateTitle.textContent = 'Match Rate Percentage';
            
            const matchRateBars = document.createElement('div');
            matchRateBars.className = 'global-histogram-bars';
            
            const maxMatchRate = Math.max(...models.map(model => (data[model].global.matched_cases / data[model].global.total_cases) * 100));
            
            models.forEach(model => {
                const modelData = data[model].global;
                const matchRate = (modelData.matched_cases / modelData.total_cases) * 100;
                const height = (matchRate / maxMatchRate) * 100;
                
                const bar = document.createElement('div');
                bar.className = 'global-histogram-bar';
                bar.style.height = `${height}%`;
                bar.textContent = `${matchRate.toFixed(1)}%`;
                bar.setAttribute('data-label', model.toUpperCase());
                bar.title = `${model.toUpperCase()}: ${matchRate.toFixed(1)}% (${modelData.matched_cases}/${modelData.total_cases})`;
                
                matchRateBars.appendChild(bar);
            });
            
            const matchRateLabels = document.createElement('div');
            matchRateLabels.className = 'global-histogram-labels';
            models.forEach(model => {
                const label = document.createElement('div');
                label.className = 'global-histogram-label';
                label.textContent = model.toUpperCase();
                matchRateLabels.appendChild(label);
            });
            
            const matchRateSubtitle = document.createElement('div');
            matchRateSubtitle.className = 'global-histogram-subtitle';
            matchRateSubtitle.textContent = 'Cases successfully matched';
            
            matchRateChart.appendChild(matchRateTitle);
            matchRateChart.appendChild(matchRateBars);
            matchRateChart.appendChild(matchRateLabels);
            matchRateChart.appendChild(matchRateSubtitle);
            
            // Create Average Position Histogram (inverted - lower is better)
            const avgPositionChart = document.createElement('div');
            avgPositionChart.className = 'global-histogram';
            
            const avgPositionTitle = document.createElement('div');
            avgPositionTitle.className = 'global-histogram-title';
            avgPositionTitle.textContent = 'Average Position Quality';
            
            const avgPositionBars = document.createElement('div');
            avgPositionBars.className = 'global-histogram-bars';
            
            const minAvgPosition = Math.min(...models.map(model => data[model].global.average_position));
            const maxAvgPosition = Math.max(...models.map(model => data[model].global.average_position));
            
            models.forEach(model => {
                const modelData = data[model].global;
                const avgPosition = modelData.average_position;
                // Invert the height calculation (lower position = higher bar)
                const qualityScore = maxAvgPosition - avgPosition + minAvgPosition;
                const height = (qualityScore / (maxAvgPosition - minAvgPosition + minAvgPosition)) * 100;
                
                const bar = document.createElement('div');
                bar.className = 'global-histogram-bar';
                bar.style.height = `${height}%`;
                bar.textContent = avgPosition.toFixed(3);
                bar.setAttribute('data-label', model.toUpperCase());
                bar.title = `${model.toUpperCase()}: ${avgPosition.toFixed(3)} average position`;
                
                avgPositionBars.appendChild(bar);
            });
            
            const avgPositionLabels = document.createElement('div');
            avgPositionLabels.className = 'global-histogram-labels';
            models.forEach(model => {
                const label = document.createElement('div');
                label.className = 'global-histogram-label';
                label.textContent = model.toUpperCase();
                avgPositionLabels.appendChild(label);
            });
            
            const avgPositionSubtitle = document.createElement('div');
            avgPositionSubtitle.className = 'global-histogram-subtitle';
            avgPositionSubtitle.textContent = 'Lower position is better (inverted scale)';
            
            avgPositionChart.appendChild(avgPositionTitle);
            avgPositionChart.appendChild(avgPositionBars);
            avgPositionChart.appendChild(avgPositionLabels);
            avgPositionChart.appendChild(avgPositionSubtitle);
            
            // Add all charts to container
            histogramContainer.appendChild(finalScoreChart);
            histogramContainer.appendChild(matchRateChart);
            histogramContainer.appendChild(avgPositionChart);
            
            container.appendChild(histogramContainer);
        }

        function createTopPositionChart() {
            const container = document.getElementById('topPositionChart');
            const models = ['4o', 'o1', 'o3', 'o3pro'];
            
            models.forEach(model => {
                const modelData = data[model].global;
                const topCounts = modelData.top_counts;
                const total = modelData.matched_cases;
                
                const chartDiv = document.createElement('div');
                chartDiv.style.marginBottom = '20px';
                
                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = model.toUpperCase();
                label.style.width = '60px';
                label.style.marginBottom = '5px';
                label.style.textAlign = 'left';
                label.style.fontWeight = 'bold';
                
                const stackedBar = document.createElement('div');
                stackedBar.className = 'stacked-bar';
                
                ['P1', 'P2', 'P3', 'P4', 'P5'].forEach((pos, index) => {
                    const count = topCounts[pos] || 0;
                    const percentage = (count / total) * 100;
                    
                    if (count > 0) {
                        const segment = document.createElement('div');
                        segment.className = `stack-segment top-${pos.toLowerCase()}`;
                        segment.style.width = `${percentage}%`;
                        segment.textContent = count;
                        stackedBar.appendChild(segment);
                    }
                });
                
                chartDiv.appendChild(label);
                chartDiv.appendChild(stackedBar);
                container.appendChild(chartDiv);
            });
            
            // Add legend
            const legend = document.createElement('div');
            legend.className = 'legend';
            ['P1', 'P2', 'P3', 'P4', 'P5'].forEach(pos => {
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `
                    <div class="legend-color top-${pos.toLowerCase()}"></div>
                    <span class="legend-label">${pos}</span>
                `;
                legend.appendChild(item);
            });
            container.appendChild(legend);
        }

        function createBubbleChart() {
            const container = document.getElementById('bubbleChart');
            const models = ['4o', 'o1', 'o3', 'o3pro'];
            const methods = ['SNOMED_MATCH', 'ICD10_EXACT', 'ICD10_SIBLING', 'ICD10_PARENT', 'BERT_AUTOCONFIRM', 'BERT_MATCH', 'LLM_JUDGMENT'];
            
            const chart = document.createElement('div');
            chart.className = 'bubble-chart';
            
            const grid = document.createElement('div');
            grid.className = 'bubble-chart-grid';
            chart.appendChild(grid);
            
            // Create axes
            const axes = document.createElement('div');
            axes.className = 'bubble-axes';
            
            const xAxis = document.createElement('div');
            xAxis.className = 'bubble-axis-x';
            xAxis.textContent = 'Usage Frequency (cases) →';
            
            const yAxis = document.createElement('div');
            yAxis.className = 'bubble-axis-y';
            yAxis.textContent = '← Performance Quality (avg position)';
            
            axes.appendChild(xAxis);
            axes.appendChild(yAxis);
            chart.appendChild(axes);
            
            // Get data ranges for normalization
            const allUsage = [];
            const allPerformance = [];
            
            models.forEach(model => {
                methods.forEach(method => {
                    const methodData = data[model].by_method[method];
                    if (methodData) {
                        allUsage.push(methodData.total_cases);
                        allPerformance.push(methodData.average_position);
                    }
                });
            });
            
            const minUsage = Math.min(...allUsage);
            const maxUsage = Math.max(...allUsage);
            const minPerf = Math.min(...allPerformance);
            const maxPerf = Math.max(...allPerformance);
            
            // Create bubbles for each model
            models.forEach((model, modelIndex) => {
                methods.forEach(method => {
                    const methodData = data[model].by_method[method];
                    if (methodData) {
                        const usage = methodData.total_cases;
                        const performance = methodData.average_position;
                        
                        // Position calculation (within chart bounds)
                        const x = 80 + ((usage - minUsage) / (maxUsage - minUsage)) * (100 - 80 - 20); // 80px left margin, 20px right margin
                        const y = 20 + ((maxPerf - performance) / (maxPerf - minPerf)) * (100 - 20 - 30); // Inverted Y (better = higher), 30px bottom margin
                        
                        // Size calculation (20px to 80px diameter)
                        const size = 20 + ((usage - minUsage) / (maxUsage - minUsage)) * 60;
                        
                        // Color based on performance (better = darker)
                        let colorClass = 'intensity-medium';
                        if (performance < 1.4) colorClass = 'intensity-very-high';
                        else if (performance < 1.7) colorClass = 'intensity-high';
                        else if (performance < 2.0) colorClass = 'intensity-medium';
                        else if (performance < 2.3) colorClass = 'intensity-low';
                        else colorClass = 'intensity-very-low';
                        
                        const bubble = document.createElement('div');
                        bubble.className = `bubble ${colorClass}`;
                        bubble.style.left = `${x}%`;
                        bubble.style.top = `${y}%`;
                        bubble.style.width = `${size}px`;
                        bubble.style.height = `${size}px`;
                        bubble.style.transform = 'translate(-50%, -50%)';
                        
                        // Show usage count in bubble
                        bubble.textContent = usage;
                        
                        // Add tooltip
                        bubble.title = `${model.toUpperCase()} - ${method.replace('_', ' ')}\nUsage: ${usage} cases (${((usage/450)*100).toFixed(1)}%)\nPerformance: ${performance.toFixed(3)} avg position`;
                        
                        // Add label
                        const label = document.createElement('div');
                        label.className = 'bubble-label';
                        label.textContent = `${model.toUpperCase()}-${method.substring(0,6)}`;
                        bubble.appendChild(label);
                        
                        chart.appendChild(bubble);
                    }
                });
            });
            
            container.appendChild(chart);
            
            // Add legend
            const legend = document.createElement('div');
            legend.className = 'chart-legend';
            legend.innerHTML = `
                <div class="legend-title">Bubble Chart Legend</div>
                <div class="legend-grid">
                    <div class="legend-item-detailed">
                        <strong>Bubble Size:</strong> Usage frequency (number of cases)
                    </div>
                    <div class="legend-item-detailed">
                        <strong>Bubble Color:</strong> Performance quality (darker = better avg position)
                    </div>
                    <div class="legend-item-detailed">
                        <strong>X-axis:</strong> Usage frequency →
                    </div>
                    <div class="legend-item-detailed">
                        <strong>Y-axis:</strong> Performance quality ↑
                    </div>
                </div>
            `;
            container.appendChild(legend);
        }

        function createHybridMatrix() {
            const container = document.getElementById('hybridMatrix');
            const models = ['4o', 'o1', 'o3', 'o3pro'];
            const methods = ['SNOMED_MATCH', 'ICD10_EXACT', 'ICD10_SIBLING', 'ICD10_PARENT', 'BERT_AUTOCONFIRM', 'BERT_MATCH', 'LLM_JUDGMENT'];
            
            const matrix = document.createElement('div');
            matrix.className = 'hybrid-matrix';
            
            // Header row
            const headerEmpty = document.createElement('div');
            headerEmpty.className = 'matrix-header';
            headerEmpty.textContent = 'Method';
            matrix.appendChild(headerEmpty);
            
            models.forEach(model => {
                const header = document.createElement('div');
                header.className = 'matrix-header';
                header.textContent = model.toUpperCase();
                matrix.appendChild(header);
            });
            
            // Get data ranges for normalization
            const allUsage = [];
            const allPerformance = [];
            
            models.forEach(model => {
                methods.forEach(method => {
                    const methodData = data[model].by_method[method];
                    if (methodData) {
                        allUsage.push(methodData.total_cases);
                        allPerformance.push(methodData.average_position);
                    }
                });
            });
            
            const minUsage = Math.min(...allUsage);
            const maxUsage = Math.max(...allUsage);
            const minPerf = Math.min(...allPerformance);
            const maxPerf = Math.max(...allPerformance);
            
            // Data rows
            methods.forEach(method => {
                const methodHeader = document.createElement('div');
                methodHeader.className = 'matrix-header';
                methodHeader.textContent = method.replace('_', ' ');
                matrix.appendChild(methodHeader);
                
                models.forEach(model => {
                    const cell = document.createElement('div');
                    cell.className = 'hybrid-cell';
                    
                    const methodData = data[model].by_method[method];
                    if (methodData) {
                        const usage = methodData.total_cases;
                        const performance = methodData.average_position;
                        
                        // Circle size based on usage (30px to 70px)
                        const circleSize = 30 + ((usage - minUsage) / (maxUsage - minUsage)) * 40;
                        
                        // Color based on performance
                        let colorClass = 'intensity-medium';
                        if (performance < 1.4) colorClass = 'intensity-very-high';
                        else if (performance < 1.7) colorClass = 'intensity-high';
                        else if (performance < 2.0) colorClass = 'intensity-medium';
                        else if (performance < 2.3) colorClass = 'intensity-low';
                        else colorClass = 'intensity-very-low';
                        
                        const circle = document.createElement('div');
                        circle.className = `hybrid-circle ${colorClass}`;
                        circle.style.width = `${circleSize}px`;
                        circle.style.height = `${circleSize}px`;
                        circle.textContent = usage;
                        
                        const info = document.createElement('div');
                        info.className = 'hybrid-info';
                        info.innerHTML = `
                            <div class="hybrid-usage">${usage} cases</div>
                            <div class="hybrid-performance">${performance.toFixed(3)} avg</div>
                        `;
                        
                        cell.appendChild(circle);
                        cell.appendChild(info);
                    } else {
                        const circle = document.createElement('div');
                        circle.className = 'hybrid-circle intensity-very-low';
                        circle.style.width = '30px';
                        circle.style.height = '30px';
                        circle.textContent = '0';
                        
                        const info = document.createElement('div');
                        info.className = 'hybrid-info';
                        info.innerHTML = `
                            <div class="hybrid-usage">0 cases</div>
                            <div class="hybrid-performance">N/A</div>
                        `;
                        
                        cell.appendChild(circle);
                        cell.appendChild(info);
                    }
                    
                    matrix.appendChild(cell);
                });
            });
            
            container.appendChild(matrix);
            
            // Add legend
            const legend = document.createElement('div');
            legend.className = 'chart-legend';
            legend.innerHTML = `
                <div class="legend-title">Hybrid Matrix Legend</div>
                <div class="legend-grid">
                    <div class="legend-item-detailed">
                        <strong>Circle Size:</strong> Usage frequency (larger = more cases)
                    </div>
                    <div class="legend-item-detailed">
                        <strong>Circle Color:</strong> Performance quality (darker = better avg position)
                    </div>
                    <div class="legend-item-detailed">
                        <strong>Number in Circle:</strong> Total cases processed
                    </div>
                    <div class="legend-item-detailed">
                        <strong>Text Below:</strong> Usage count + Average position
                    </div>
                </div>
            `;
            container.appendChild(legend);
        }

        function createMethodHistograms() {
            const container = document.getElementById('methodHistograms');
            const models = ['4o', 'o1', 'o3', 'o3pro'];
            const methods = ['SNOMED_MATCH', 'ICD10_EXACT', 'ICD10_SIBLING', 'ICD10_PARENT', 'BERT_AUTOCONFIRM', 'BERT_MATCH', 'LLM_JUDGMENT'];
            
            const histogramContainer = document.createElement('div');
            histogramContainer.className = 'horizontal-histograms';
            
            // Now iterate by model instead of method
            models.forEach(model => {
                const histogram = document.createElement('div');
                histogram.className = 'horizontal-histogram';
                
                const label = document.createElement('div');
                label.className = 'histogram-method-label';
                label.textContent = model.toUpperCase();
                
                const stackedBar = document.createElement('div');
                stackedBar.className = 'horizontal-stacked-bar';
                
                // Calculate total cases for this model across all methods
                const totalCases = methods.reduce((sum, method) => {
                    return sum + (data[model].global.resolution_method_counts[method] || 0);
                }, 0);
                
                // Create segments for each method
                methods.forEach(method => {
                    const count = data[model].global.resolution_method_counts[method] || 0;
                    
                    if (count > 0) {
                        const percentage = (count / totalCases) * 100;
                        
                        const segment = document.createElement('div');
                        segment.className = `horizontal-segment method-${method.toLowerCase().replace('_', '-')}`;
                        segment.style.width = `${percentage}%`;
                        segment.textContent = count;
                        
                        // Add tooltip
                        const tooltip = document.createElement('div');
                        tooltip.className = 'segment-tooltip';
                        tooltip.textContent = `${method.replace('_', ' ')}: ${count} cases (${percentage.toFixed(1)}%)`;
                        segment.appendChild(tooltip);
                        
                        segment.title = `${method.replace('_', ' ')}: ${count} cases`;
                        
                        stackedBar.appendChild(segment);
                    }
                });
                
                const total = document.createElement('div');
                total.className = 'histogram-total';
                total.textContent = `Total: ${totalCases}`;
                
                histogram.appendChild(label);
                histogram.appendChild(stackedBar);
                histogram.appendChild(total);
                
                histogramContainer.appendChild(histogram);
            });
            
            container.appendChild(histogramContainer);
            
            // Add legend
            const legend = document.createElement('div');
            legend.className = 'chart-legend';
            legend.innerHTML = `
                <div class="legend-title">Horizontal Stacked Bars Legend</div>
                <div class="legend-grid">
                    <div class="legend-item-detailed">
                        <div class="legend-color method-snomed-match"></div>
                        <strong>SNOMED MATCH</strong>
                    </div>
                    <div class="legend-item-detailed">
                        <div class="legend-color method-icd10-exact"></div>
                        <strong>ICD10 EXACT</strong>
                    </div>
                    <div class="legend-item-detailed">
                        <div class="legend-color method-icd10-sibling"></div>
                        <strong>ICD10 SIBLING</strong>
                    </div>
                    <div class="legend-item-detailed">
                        <div class="legend-color method-icd10-parent"></div>
                        <strong>ICD10 PARENT</strong>
                    </div>
                    <div class="legend-item-detailed">
                        <div class="legend-color method-bert-autoconfirm"></div>
                        <strong>BERT AUTOCONFIRM</strong>
                    </div>
                    <div class="legend-item-detailed">
                        <div class="legend-color method-bert-match"></div>
                        <strong>BERT MATCH</strong>
                    </div>
                    <div class="legend-item-detailed">
                        <div class="legend-color method-llm-judgment"></div>
                        <strong>LLM JUDGMENT</strong>
                    </div>
                </div>
            `;
            container.appendChild(legend);
        }

        function createLineChart() {
            const container = document.getElementById('lineChart');
            const models = ['4o', 'o1', 'o3', 'o3pro'];
            const methods = ['SNOMED_MATCH', 'BERT_MATCH', 'ICD10_EXACT', 'ICD10_PARENT', 'ICD10_SIBLING', 'BERT_AUTOCONFIRM', 'LLM_JUDGMENT'];
            
            const chartContainer = document.createElement('div');
            chartContainer.className = 'line-chart-container';
            
            const chart = document.createElement('div');
            chart.className = 'line-chart';
            
            const grid = document.createElement('div');
            grid.className = 'line-chart-grid';
            chart.appendChild(grid);
            
            // Create SVG for lines
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.position = 'absolute';
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.top = '0';
            svg.style.left = '0';
            
            const chartWidth = 800;
            const chartHeight = 300;
            
            models.forEach((model, modelIndex) => {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.classList.add(`line-${model}`);
                
                let pathData = '';
                methods.forEach((method, methodIndex) => {
                    const methodData = data[model].by_method[method];
                    if (methodData) {
                        const x = (methodIndex / (methods.length - 1)) * chartWidth;
                        const y = chartHeight - ((methodData.average_position - 1) / 2) * chartHeight;
                        
                        if (methodIndex === 0) {
                            pathData += `M ${x} ${y}`;
                        } else {
                            pathData += ` L ${x} ${y}`;
                        }
                        
                        // Add point
                        const point = document.createElement('div');
                        point.className = `line-chart-point point-${model}`;
                        point.style.left = `${(x / chartWidth) * 100}%`;
                        point.style.top = `${(y / chartHeight) * 100}%`;
                        point.textContent = methodData.average_position.toFixed(2);
                        point.title = `${model.toUpperCase()} - ${method}: ${methodData.average_position.toFixed(3)}`;
                        chart.appendChild(point);
                    }
                });
                
                path.setAttribute('d', pathData);
                svg.appendChild(path);
            });
            
            chart.appendChild(svg);
            
            const labels = document.createElement('div');
            labels.className = 'line-chart-labels';
            
            methods.forEach(method => {
                const label = document.createElement('div');
                label.className = 'line-chart-label';
                label.textContent = method.replace('_', ' ').substring(0, 10);
                labels.appendChild(label);
            });
            
            chartContainer.appendChild(chart);
            chartContainer.appendChild(labels);
            
            // Add legend
            const legend = document.createElement('div');
            legend.className = 'legend';
            models.forEach(model => {
                const item = document.createElement('div');
                item.className = 'legend-item';
                item.innerHTML = `
                    <div class="legend-color point-${model}"></div>
                    <span class="legend-label">${model.toUpperCase()}</span>
                `;
                legend.appendChild(item);
            });
            chartContainer.appendChild(legend);
            
            container.appendChild(chartContainer);
        }

        function createComparisonMatrix() {
            const container = document.getElementById('comparisonMatrix');
            const models = ['4o', 'o1', 'o3', 'o3pro'];
            const methods = ['SNOMED_MATCH', 'ICD10_EXACT', 'ICD10_SIBLING', 'ICD10_PARENT', 'BERT_AUTOCONFIRM', 'BERT_MATCH', 'LLM_JUDGMENT'];
            
            // Get all case counts to find the maximum for proportional scaling
            const allCounts = [];
            methods.forEach(method => {
                models.forEach(model => {
                    const methodData = data[model].by_method[method];
                    if (methodData) {
                        allCounts.push(methodData.total_cases);
                    }
                });
            });
            
            const maxCases = Math.max(...allCounts);
            
            const matrix = document.createElement('div');
            matrix.className = 'proportional-matrix';
            
            // Header row
            const headerEmpty = document.createElement('div');
            headerEmpty.className = 'matrix-header';
            headerEmpty.textContent = 'Method';
            matrix.appendChild(headerEmpty);
            
            models.forEach(model => {
                const header = document.createElement('div');
                header.className = 'matrix-header';
                header.textContent = model.toUpperCase();
                matrix.appendChild(header);
            });
            
            // Data rows with proportional fill
            methods.forEach(method => {
                const methodHeader = document.createElement('div');
                methodHeader.className = 'matrix-header';
                methodHeader.textContent = method.replace('_', ' ');
                matrix.appendChild(methodHeader);
                
                models.forEach(model => {
                    const cell = document.createElement('div');
                    cell.className = 'proportional-cell';
                    
                    const methodData = data[model].by_method[method];
                    if (methodData) {
                        const cases = methodData.total_cases;
                        const avgPos = methodData.average_position;
                        
                        // Calculate proportional width (percentage of maximum)
                        const fillPercentage = (cases / maxCases) * 100;
                        
                        // Color based on performance quality
                        let colorClass = 'intensity-medium';
                        if (avgPos < 1.4) colorClass = 'intensity-very-high';
                        else if (avgPos < 1.7) colorClass = 'intensity-high';
                        else if (avgPos < 2.0) colorClass = 'intensity-medium';
                        else if (avgPos < 2.3) colorClass = 'intensity-low';
                        else colorClass = 'intensity-very-low';
                        
                        const bar = document.createElement('div');
                        bar.className = `proportional-bar ${colorClass}`;
                        bar.style.width = `${fillPercentage}%`;
                        bar.textContent = cases;
                        bar.title = `${model.toUpperCase()} - ${method.replace('_', ' ')}\nCases: ${cases}\nAvg Position: ${avgPos.toFixed(3)}`;
                        
                        cell.appendChild(bar);
                    } else {
                        const bar = document.createElement('div');
                        bar.className = 'proportional-bar intensity-very-low';
                        bar.style.width = '0%';
                        bar.textContent = '0';
                        
                        cell.appendChild(bar);
                    }
                    
                    matrix.appendChild(cell);
                });
            });
            
            container.appendChild(matrix);
            
            // Add legend
            const legend = document.createElement('div');
            legend.className = 'chart-legend';
            legend.innerHTML = `
                <div class="legend-title">Performance Quality Color Ranges</div>
                <div class="legend-grid">
                    <div class="legend-item-detailed">
                        <div class="legend-color intensity-very-high"></div>
                        <strong>Position 1.0 - 1.4</strong> (Excellent)
                    </div>
                    <div class="legend-item-detailed">
                        <div class="legend-color intensity-high"></div>
                        <strong>Position 1.4 - 1.7</strong> (Good)
                    </div>
                    <div class="legend-item-detailed">
                        <div class="legend-color intensity-medium"></div>
                        <strong>Position 1.7 - 2.0</strong> (Average)
                    </div>
                    <div class="legend-item-detailed">
                        <div class="legend-color intensity-low"></div>
                        <strong>Position 2.0 - 2.3</strong> (Below Average)
                    </div>
                    <div class="legend-item-detailed">
                        <div class="legend-color intensity-very-low"></div>
                        <strong>Position 2.3+</strong> (Poor)
                    </div>
                </div>
            `;
            container.appendChild(legend);
        }

        // Initialize all charts
        document.addEventListener('DOMContentLoaded', function() {
            createGlobalMetrics();
            createGlobalHistograms();
            createTopPositionChart();
            createBubbleChart();
            createHybridMatrix();
            createMethodHistograms();
            createLineChart();
            createComparisonMatrix();
        });
    </script>
</body>
</html>